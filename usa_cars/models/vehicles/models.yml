version: 2

models:
  - name: all_cars
    description: "All car data from the USA Cars dataset"
    columns:
      - name: brand
        tests:
          - not_null
      - name: model
        tests:
          - not_null
      - name: mileage
        tests:
          - not_null
      - name: year
        tests:
          - not_null
      - name: price
        tests:
          - not_null
      - name: country
        description: "Country where the car is from"
        tests:
          - not_null


  - name: brand_model_stats
    tests:
      - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
          column_A: max_price
          column_B: min_price
          or_equal: True
      - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
          column_A: max_year
          column_B: min_year
          or_equal: True
      - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
          column_A: max_mileage
          column_B: min_mileage
          or_equal: True
    description: "Aggregated statistics for each car brand and model"
    columns:
      - name: brand
        tests:
          - not_null
      - name: model
        tests:
          - not_null
      - name: min_price
        description: "Minimum price for the brand and model"
      - name: max_price
        description: "Maximum price for the brand and model"



  - name: high_value_cars
    description: "Cars in the top 10 percentiles based on price, partitioned by year"
    columns:
      - name: price
        tests:
          - not_null
      - name: year_price_percentile
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.9
              max_value: 1.0

